# VDOT 计算说明

VDOT (V̇O2max) 是由著名跑步教练 Jack Daniels 提出的跑力指标，用于量化跑者的有氧能力和训练效果。

## 目录

- [什么是 VDOT](#什么是-vdot)
- [计算公式](#计算公式)
- [实现细节](#实现细节)
- [心率校准](#心率校准)
- [训练配速建议](#训练配速建议)
- [使用建议](#使用建议)

---

## 什么是 VDOT

### 定义

VDOT 代表 **V̇O2max** (最大摄氧量)，是衡量有氧运动能力的核心指标。Jack Daniels 在其著作 *Daniels' Running Formula* 中提出了基于跑步成绩计算 VDOT 的方法。

### 意义

- **训练效果评估**: 追踪 VDOT 变化可以量化训练效果
- **配速指导**: 根据 VDOT 可以计算不同训练类型的建议配速
- **比赛预测**: 根据 VDOT 可以预测不同距离的比赛成绩
- **跨距离比较**: 不同距离的成绩可以通过 VDOT 进行标准化比较

### 典型 VDOT 值

| 水平 | VDOT | 5K 时间 | 10K 时间 | 半马时间 | 全马时间 |
|------|------|---------|----------|----------|----------|
| 入门 | 30-35 | 30:00+ | 62:00+ | 2:20:00+ | 5:00:00+ |
| 初级 | 35-40 | 26:00-30:00 | 54:00-62:00 | 2:00:00-2:20:00 | 4:15:00-5:00:00 |
| 中级 | 40-50 | 20:00-26:00 | 42:00-54:00 | 1:35:00-2:00:00 | 3:20:00-4:15:00 |
| 高级 | 50-60 | 16:00-20:00 | 33:00-42:00 | 1:15:00-1:35:00 | 2:40:00-3:20:00 |
| 精英 | 60-70 | 13:30-16:00 | 28:00-33:00 | 1:02:00-1:15:00 | 2:15:00-2:40:00 |
| 专业 | 70+ | <13:30 | <28:00 | <1:02:00 | <2:15:00 |

---

## 计算公式

### 1. 计算速度

首先将距离和时间转换为速度（米/分钟）：

```
velocity = distance (meters) / duration (minutes)
```

示例：

```
距离: 10000 米
时间: 3000 秒 = 50 分钟
velocity = 10000 / 50 = 200 m/min
```

### 2. 计算 VO2max

根据速度计算 VO2max：

```
VO2max = -4.60 + 0.182258 × velocity + 0.000104 × velocity²
```

示例：

```
velocity = 200 m/min
VO2max = -4.60 + 0.182258 × 200 + 0.000104 × 200²
       = -4.60 + 36.4516 + 4.16
       = 36.01 ml/kg/min
```

### 3. 计算能量消耗比例

根据跑步时长计算能量消耗比例：

```
energy_percent = 0.8 + 0.1894393 × e^(-0.012778 × t) + 0.2989558 × e^(-0.1932605 × t)
```

其中 `t` 是跑步时长（分钟）。

示例：

```
t = 50 分钟
energy_percent = 0.8 + 0.1894393 × e^(-0.012778 × 50) + 0.2989558 × e^(-0.1932605 × 50)
               = 0.8 + 0.1894393 × 0.5273 + 0.2989558 × 0.0000454
               = 0.8 + 0.0999 + 0.0000136
               = 0.8999
```

### 4. 计算 VDOT

```
VDOT = VO2max / energy_percent
```

示例：

```
VDOT = 36.01 / 0.8999
     = 40.01
```

### 完整示例

对于 10K 跑 50 分钟（配速 5:00 /km）：

```
1. velocity = 10000 / 50 = 200 m/min
2. VO2max = -4.60 + 0.182258 × 200 + 0.000104 × 40000 = 36.01
3. energy_percent = 0.8 + 0.1894393 × e^(-0.6389) + 0.2989558 × e^(-9.663) = 0.8999
4. VDOT = 36.01 / 0.8999 = 40.01
```

---

## 实现细节

### 代码实现

以下是本项目中的 VDOT 计算函数（简化版）：

```javascript
function calculateVDOT(distanceMeters, durationSeconds, avgHeartRate = null, maxHR = null, restingHR = null) {
  // 1. 计算速度 (m/min)
  const durationMinutes = durationSeconds / 60;
  const velocity = distanceMeters / durationMinutes;

  // 2. 计算 VO2max
  const vo2max = -4.60 + 0.182258 * velocity + 0.000104 * (velocity ** 2);

  // 3. 计算能量消耗比例
  const energyPercent =
    0.8 +
    0.1894393 * Math.exp(-0.012778 * durationMinutes) +
    0.2989558 * Math.exp(-0.1932605 * durationMinutes);

  // 4. 计算基础 VDOT
  let vdot = vo2max / energyPercent;

  // 5. 心率校准 (可选)
  if (avgHeartRate && maxHR && restingHR) {
    const hrr = maxHR - restingHR;
    const hrPercent = (avgHeartRate - restingHR) / hrr;

    // 根据心率百分比调整 VDOT
    // 如果心率偏低，说明实际能力更强，上调 VDOT
    // 如果心率偏高，说明实际能力较弱，下调 VDOT
    const expectedHRPercent = 0.70; // 假设 70% 心率储备对应当前配速
    const hrAdjustment = (expectedHRPercent - hrPercent) * 5; // 每 1% 差异调整 5 个 VDOT 点
    vdot += hrAdjustment;
  }

  return Math.round(vdot * 10) / 10; // 保留 1 位小数
}
```

### 有效性验证

VDOT 计算仅在以下条件下有效：

1. **距离 ≥ 1000 米**: 短距离跑步不适用 VDOT 理论
2. **持续时间 ≥ 3 分钟**: 过短的跑步无法准确反映有氧能力
3. **配速稳定**: 大幅变速或间歇跑可能导致计算不准确

代码中的验证逻辑：

```javascript
if (distanceMeters < 1000 || durationSeconds < 180) {
  return null; // 不计算 VDOT
}
```

---

## 心率校准

### 为什么需要心率校准？

同样的配速，不同的心率反映了不同的运动强度：

- **心率低**: 说明当前配速对你来说较轻松，实际能力可能更强
- **心率高**: 说明当前配速对你来说较吃力，实际能力可能较弱

心率校准可以更准确地反映真实的有氧能力。

### 心率储备计算

```
心率储备 (HRR) = MAX_HR - RESTING_HR
心率储备百分比 = (平均心率 - RESTING_HR) / HRR
```

示例：

```
MAX_HR = 190 bpm
RESTING_HR = 55 bpm
平均心率 = 150 bpm

HRR = 190 - 55 = 135 bpm
心率储备百分比 = (150 - 55) / 135 = 70.4%
```

### 校准逻辑

根据心率储备百分比调整 VDOT：

| 心率储备百分比 | 训练强度 | VDOT 调整 |
|----------------|----------|-----------|
| 50-60% | 轻松跑 | +5 |
| 60-70% | 有氧跑 | +2 |
| 70-80% | 节奏跑 | 0 |
| 80-90% | 间歇跑 | -2 |
| 90-100% | 冲刺 | -5 |

### 配置心率参数

在 `.env` 文件中配置：

```bash
MAX_HR=190        # 最大心率
RESTING_HR=55     # 静息心率
```

**如何测量最大心率**:

1. **估算**: `220 - 年龄` (粗略估计)
2. **实测**: 热身后全力跑 3-5 分钟，记录最高心率
3. **专业测试**: 在运动实验室进行递增负荷测试

**如何测量静息心率**:

1. 早晨醒来后，保持躺姿
2. 测量 1 分钟心率
3. 连续测量 3-5 天取平均值

---

## 训练配速建议

根据 VDOT 可以计算不同训练类型的建议配速。

### Daniels 训练区间

| 训练类型 | 强度 | VDOT 百分比 | 心率区间 | 训练目的 |
|----------|------|-------------|----------|----------|
| **E (Easy)** | 轻松跑 | 59-74% | Zone 1-2 | 有氧基础，恢复 |
| **M (Marathon)** | 马拉松配速 | 75-84% | Zone 2-3 | 马拉松专项 |
| **T (Threshold)** | 乳酸阈值 | 83-88% | Zone 3 | 提高乳酸阈值 |
| **I (Interval)** | 间歇跑 | 95-100% | Zone 4-5 | 提高 VO2max |
| **R (Repetition)** | 重复跑 | 105-120% | Zone 5 | 速度和力量 |

### 配速计算示例

假设 VDOT = 50，对应的训练配速：

```javascript
function getTrainingPaces(vdot) {
  return {
    easy: calculatePace(vdot * 0.65),      // E 配速: 5:40-6:10 /km
    marathon: calculatePace(vdot * 0.80),  // M 配速: 4:40 /km
    threshold: calculatePace(vdot * 0.85), // T 配速: 4:20 /km
    interval: calculatePace(vdot * 0.98),  // I 配速: 3:45 /km
    repetition: calculatePace(vdot * 1.10) // R 配速: 3:20 /km
  };
}
```

对于 VDOT = 50:

- **E (轻松跑)**: 5:40-6:10 /km
- **M (马拉松配速)**: 4:40 /km
- **T (节奏跑)**: 4:20 /km
- **I (间歇跑)**: 3:45 /km (如 5×1000m)
- **R (重复跑)**: 3:20 /km (如 10×400m)

### 训练计划建议

基于 VDOT 的周训练计划（示例）：

| 周几 | 训练类型 | 距离/时长 | 配速 |
|------|----------|-----------|------|
| 周一 | 休息 | - | - |
| 周二 | E 轻松跑 | 8 km | 5:50 /km |
| 周三 | T 节奏跑 | 3×2000m | 4:20 /km |
| 周四 | E 轻松跑 | 6 km | 6:00 /km |
| 周五 | 休息 | - | - |
| 周六 | I 间歇跑 | 6×1000m | 3:45 /km |
| 周日 | E 长距离 | 15 km | 5:40 /km |

---

## 使用建议

### 1. VDOT 不是唯一指标

VDOT 只是衡量有氧能力的一个维度，还需要考虑：

- **肌肉力量**: 影响配速稳定性和抗疲劳能力
- **跑步经济性**: 同样 VDOT，跑步姿势好的跑者更省力
- **心理素质**: 比赛中的心理韧性也很重要

### 2. 追踪趋势，而非单次数值

- 单次跑步的 VDOT 可能受天气、身体状态、路况等影响
- 建议关注 **7 天或 30 天的移动平均值**
- 上升趋势说明训练有效，下降趋势需要调整训练计划

### 3. 根据 VDOT 调整训练强度

- **VDOT 提升过快**: 注意避免过度训练，适当增加休息
- **VDOT 长期停滞**: 需要调整训练计划，增加强度或变化训练内容
- **VDOT 下降**: 检查是否过度训练、睡眠不足或营养不良

### 4. 不同距离的 VDOT 可能不同

- **短距离 (5K)**: VDOT 可能较高，反映速度能力
- **长距离 (半马/全马)**: VDOT 可能较低，反映耐力能力
- 全面的跑者应该平衡不同距离的训练

### 5. 心率数据的重要性

- 如果没有心率数据，VDOT 仅基于配速计算，可能不够准确
- 建议使用心率带或光电心率监测设备
- 心率校准后的 VDOT 更能反映真实的有氧能力

---

## 常见问题

### Q1: 我的 VDOT 为什么突然下降？

可能原因：

1. **过度训练**: 身体疲劳导致表现下降
2. **环境因素**: 高温、高湿、强风等影响配速
3. **身体状态**: 感冒、睡眠不足、压力大等
4. **路况差异**: 爬坡、不平整路面等

解决方案：关注趋势而非单次数值，适当休息和调整训练。

### Q2: 跑步机上的 VDOT 准确吗？

跑步机上的 VDOT 可能偏高，因为：

1. **无风阻**: 室内跑步没有风阻
2. **平坦路面**: 跑步机坡度通常为 0%
3. **速度稳定**: 跑步机强制保持配速

建议将跑步机坡度设置为 1% 以模拟户外跑步。

### Q3: 心率过高/过低会影响 VDOT 吗？

会的。心率异常可能说明：

- **心率过高**: 身体状态不佳，实际 VDOT 可能低于计算值
- **心率过低**: 心脏功能强或心率监测设备故障

如果心率数据异常，可以暂时不使用心率校准。

### Q4: 如何快速提升 VDOT？

科学的训练方法：

1. **间歇训练**: 每周 1-2 次间歇跑或节奏跑
2. **长距离慢跑**: 每周 1 次长距离慢跑，提升有氧基础
3. **力量训练**: 每周 2 次力量训练，提升跑步经济性
4. **充足休息**: 保证睡眠和恢复时间
5. **循序渐进**: 每周跑量增加不超过 10%

---

## 参考资料

1. **Daniels, J. (2013)**. *Daniels' Running Formula* (3rd ed.). Human Kinetics.
2. **Coggan, A. R. (2003)**. Training and Racing Using a Power Meter.
3. **Garmin VDOT Calculator**: [https://www8.garmin.com/manuals/webhelp/forerunner945/EN-US/GUID-...](https://www8.garmin.com/manuals/webhelp/forerunner945/EN-US/GUID-64BAB7FC-778C-45F1-9F79-9B9C2C0E3DF0.html)

---

## 下一步

- 查看 [API 参考](api-reference.md) 了解如何通过 API 获取 VDOT 数据
- 查看 [数据同步说明](data-sync.md) 了解 VDOT 计算的数据来源
- 查看 [常见问题](faq.md) 获取更多帮助

---

如有其他问题，请在 [GitHub Issues](https://github.com/xuandao/pbRun/issues) 中提出。
